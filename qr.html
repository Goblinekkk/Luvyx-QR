<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luvyx QR</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #0b0b0b; color: #e0e0e0; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid #bc13fe; }
        button { background: #bc13fe; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px; }
        input { padding: 10px; width: 80%; border-radius: 5px; border: none; margin-bottom: 10px; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; }
        #result { margin-top: 20px; word-wrap: break-word; color: #bc13fe; font-weight: bold; }
        #qrcode-gen { margin-top: 20px; display: flex; justify-content: center; background: white; padding: 10px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>Luvyx QR</h1>
    
    <div id="reader"></div>
    <p id="result">Výsledek se zobrazí zde</p>
    
    <input type="file" id="qr-input-file" accept="image/*" style="display:none">
    <button onclick="document.getElementById('qr-input-file').click()">Nahrát z obrázku</button>

    <hr style="border: 0.5px solid #333; margin: 20px 0;">

    <h3>Generovat QR</h3>
    <input type="text" id="qr-text" placeholder="Vlož odkaz nebo text">
    <button onclick="generateQR()">Vytvořit</button>
    <div id="qrcode-gen"></div>
</div>

<script>
    // 1. SKENOVÁNÍ Z KAMERY
    const html5QrCode = new Html5Qrcode("reader");
    const qrCodeSuccessCallback = (decodedText, decodedResult) => {
        document.getElementById('result').innerHTML = `<a href="${decodedText}" target="_blank" style="color:#bc13fe">${decodedText}</a>`;
        html5QrCode.stop();
    };
    
    const config = { fps: 10, qrbox: { width: 250, height: 250 } };
    html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);

    // 2. SKENOVÁNÍ Z OBRÁZKU
    const fileInput = document.getElementById('qr-input-file');
    fileInput.addEventListener('change', e => {
        if (e.target.files.length == 0) return;
        const imageFile = e.target.files[0];
        html5QrCode.scanFile(imageFile, true)
            .then(decodedText => {
                document.getElementById('result').innerHTML = `<a href="${decodedText}" target="_blank" style="color:#bc13fe">${decodedText}</a>`;
            })
            .catch(err => alert("QR kód nenalezen: " + err));
    });

    // 3. GENEROVÁNÍ QR KÓDU
    function generateQR() {
        const text = document.getElementById('qr-text').value;
        const container = document.getElementById('qrcode-gen');
        container.innerHTML = "";
        container.style.display = "block";
        if (text.trim() !== "") {
            new QRCode(container, {
                text: text,
                width: 200,
                height: 200,
                colorDark : "#000000",
                colorLight : "#ffffff"
            });
        }
    }
</script>

</body>
</html>
